# ⚠️ @claude: please update the git commit and date + time in the line below on changes ⚠️
# Pure-Rust Redox | Build: fbcond | 2026-01-15 20:43

# Various daemons that relibc needs to function as well as a bunch of env vars
# that should be set for every program.
export PATH /scheme/initfs/bin
export RUST_BACKTRACE 1
# Suppress INFO/DEBUG logging - set to 'info' or 'debug' for verbose boot
export RUST_LOG warn
# Parallelize independent daemons for faster boot
nowait rtcd
nowait nulld
nowait zerod
nowait randd

# Logging
logd
stdio /scheme/log
nowait ramfs logging

# Graphics infrastructure - targeted trace logging
export RUST_LOG fbcond=trace,inputd=trace,vesad=trace,display=trace
nowait inputd
vesad
unset FRAMEBUFFER_ADDR FRAMEBUFFER_VIRT FRAMEBUFFER_WIDTH FRAMEBUFFER_HEIGHT FRAMEBUFFER_STRIDE
#TODO: unset FRAMEBUFFER1 and beyond?
nowait fbbootlogd
nowait fbcond 1 2
export RUST_LOG warn

# Live disk
# Note: Needs to start before drivers to ensure it gets priority when redoxfs searches for disks
nowait lived

# Drivers
run /scheme/initfs/etc/init_drivers.rc
unset RSDP_ADDR RSDP_SIZE

# Mount rootfs
redoxfs --uuid $REDOXFS_UUID file $REDOXFS_BLOCK
unset REDOXFS_UUID REDOXFS_BLOCK REDOXFS_PASSWORD_ADDR REDOXFS_PASSWORD_SIZE

# Exit initfs
cd /
export PATH /usr/bin
run.d /usr/lib/init.d /etc/init.d
